---
- name: Ensure tomcat is running
  service:
    name: tomcat
    state: started
    enabled: yes

- name: Stop Tomcat server
  service:
    name: tomcat
    state: stopped

- name: Pull artifact from Nexus
  get_url:
    url: "http://192.168.4.109:8081/repository/java-docker-nexus-release/com/dept/app/MyWebApp/1.0/MyWebApp-1.0.war"
    dest: "/tmp/MyWebApp-1.0.war"

- name: Deploy application to Tomcat webapps
  copy:
    src: "/tmp/MyWebApp-1.0.war"
    dest: "/opt/tomcat/webapps/"
    remote_src: true
  become: true

- name: Start Tomcat server
  service:
    name: tomcat
    state: started


